#pragma once
#include <cuComplex.h>
#include <type_traits>
#include "config.h"


#if PRECISION == 0
    using data_type=float;
    using complex_type = cuFloatComplex;
    #define make_complex make_cuComplex
#elif PRECISION == 1
    using data_type=double;
    using complex_type = cuDoubleComplex;
    #define make_complex make_cuDoubleComplex
#endif



constexpr  __constant__ data_type realConsMod2[2] = {0.70710678118, -0.70710678118};
constexpr  __constant__ data_type realConsMod4[4] = {-0.31622776601683794, -0.9486832980505138, 0.31622776601683794, 0.9486832980505138};
constexpr  __constant__ data_type realConsMod6[8] = {-0.4629100498862757, -0.1543033499620919, -0.7715167498104595, -1.0801234497346432, 0.1543033499620919, 0.4629100498862757, 0.7715167498104595, 1.0801234497346432};
constexpr  __constant__ data_type realConsMod8[16] = {-0.3834824944236852, -0.5368754921931592, -0.2300894966542111, -0.07669649888473704, -0.8436614877321074, -0.6902684899626333, -0.9970544855015815, -1.1504474832710556, 0.3834824944236852, 0.5368754921931592, 0.2300894966542111, 0.07669649888473704, 0.8436614877321074, 0.6902684899626333, 0.9970544855015815, 1.1504474832710556};

constexpr  __constant__ data_type realCons2Mod2[2] = {0.5, 0.5};
constexpr  __constant__ data_type realCons2Mod4[4] = {0.1, 0.9, 0.1, 0.9};
constexpr  __constant__ data_type realCons2Mod6[8] = {0.214285714285714, 0.023809523809524, 0.595238095238095, 1.166666666666666, 0.023809523809524, 0.214285714285714, 0.595238095238095, 1.166666666666666};
constexpr  __constant__ data_type realCons2Mod8[16] = {0.147058823529412, 0.288235294117647, 0.052941176470588, 0.005882352941176, 0.711764705882353, 0.476470588235294, 0.994117647058823, 1.323529411764706, 0.147058823529412, 0.288235294117647, 0.052941176470588, 0.005882352941176, 0.711764705882353, 0.476470588235294, 0.994117647058823, 1.323529411764706};

constexpr  __constant__ bool realBitConsMod2[2] = {0, 1};
constexpr  __constant__ bool realBitConsMod4[8] = {0, 0,
                                           0, 1,
                                           1, 0,
                                           1, 1};
constexpr  __constant__ bool realBitConsMod6[24] = {0, 0, 0,
                                            0, 0, 1,
                                            0, 1, 0,
                                            0, 1, 1,
                                            1, 0, 0,
                                            1, 0, 1,
                                            1, 1, 0,
                                            1, 1, 1};
constexpr  __constant__ bool realBitConsMod8[64] = {0, 0, 0, 0,
                                            0, 0, 0, 1,
                                            0, 0, 1, 0,
                                            0, 0, 1, 1,
                                            0, 1, 0, 0,
                                            0, 1, 0, 1,
                                            0, 1, 1, 0,
                                            0, 1, 1, 1,
                                            1, 0, 0, 0,
                                            1, 0, 0, 1,
                                            1, 0, 1, 0,
                                            1, 0, 1, 1,
                                            1, 1, 0, 0,
                                            1, 1, 0, 1,
                                            1, 1, 1, 0,
                                            1, 1, 1, 1};

constexpr data_type normfMod2 = 0.70710678118;
constexpr data_type normfMod4 = 0.31622776601683794;
constexpr data_type normfMod6 = 0.1543033499620919;
constexpr data_type normfMod8 = 0.07669649888473704;

// will be initialized in the Detection Constructor
__constant__ complex_type complexConsMod2[4];
__constant__ complex_type complexConsMod4[16];
__constant__ complex_type complexConsMod6[64];
__constant__ complex_type complexConsMod8[256];

// indicators for whether the complexCons are initialized
static bool complexConsInitMod2 = false;
static bool complexConsInitMod4 = false;
static bool complexConsInitMod6 = false;
static bool complexConsInitMod8 = false;

constexpr  __constant__ bool complexBitConsMod2[8] = {
                                            0,0,
                                            0,1,
                                            1,0,
                                            1,1,
};
constexpr  __constant__ bool complexBitConsMod4[64] = {
                                        0,0,0,0,
                                        0,0,0,1,
                                        0,0,1,0,
                                        0,0,1,1,
                                        0,1,0,0,
                                        0,1,0,1,
                                        0,1,1,0,
                                        0,1,1,1,
                                        1,0,0,0,
                                        1,0,0,1,
                                        1,0,1,0,
                                        1,0,1,1,
                                        1,1,0,0,
                                        1,1,0,1,
                                        1,1,1,0,
                                        1,1,1,1,
};


constexpr  __constant__ bool complexBitConsMod6[384] = {
                                    0,0,0,0,0,0,
                                    0,0,0,0,0,1,
                                    0,0,0,0,1,0,
                                    0,0,0,0,1,1,
                                    0,0,0,1,0,0,
                                    0,0,0,1,0,1,
                                    0,0,0,1,1,0,
                                    0,0,0,1,1,1,
                                    0,0,1,0,0,0,
                                    0,0,1,0,0,1,
                                    0,0,1,0,1,0,
                                    0,0,1,0,1,1,
                                    0,0,1,1,0,0,
                                    0,0,1,1,0,1,
                                    0,0,1,1,1,0,
                                    0,0,1,1,1,1,
                                    0,1,0,0,0,0,
                                    0,1,0,0,0,1,
                                    0,1,0,0,1,0,
                                    0,1,0,0,1,1,
                                    0,1,0,1,0,0,
                                    0,1,0,1,0,1,
                                    0,1,0,1,1,0,
                                    0,1,0,1,1,1,
                                    0,1,1,0,0,0,
                                    0,1,1,0,0,1,
                                    0,1,1,0,1,0,
                                    0,1,1,0,1,1,
                                    0,1,1,1,0,0,
                                    0,1,1,1,0,1,
                                    0,1,1,1,1,0,
                                    0,1,1,1,1,1,
                                    1,0,0,0,0,0,
                                    1,0,0,0,0,1,
                                    1,0,0,0,1,0,
                                    1,0,0,0,1,1,
                                    1,0,0,1,0,0,
                                    1,0,0,1,0,1,
                                    1,0,0,1,1,0,
                                    1,0,0,1,1,1,
                                    1,0,1,0,0,0,
                                    1,0,1,0,0,1,
                                    1,0,1,0,1,0,
                                    1,0,1,0,1,1,
                                    1,0,1,1,0,0,
                                    1,0,1,1,0,1,
                                    1,0,1,1,1,0,
                                    1,0,1,1,1,1,
                                    1,1,0,0,0,0,
                                    1,1,0,0,0,1,
                                    1,1,0,0,1,0,
                                    1,1,0,0,1,1,
                                    1,1,0,1,0,0,
                                    1,1,0,1,0,1,
                                    1,1,0,1,1,0,
                                    1,1,0,1,1,1,
                                    1,1,1,0,0,0,
                                    1,1,1,0,0,1,
                                    1,1,1,0,1,0,
                                    1,1,1,0,1,1,
                                    1,1,1,1,0,0,
                                    1,1,1,1,0,1,
                                    1,1,1,1,1,0,
                                    1,1,1,1,1,1,
};


constexpr  __constant__ bool complexBitConsMod8[2048] = {
                                0,0,0,0,0,0,0,0,
                                0,0,0,0,0,0,0,1,
                                0,0,0,0,0,0,1,0,
                                0,0,0,0,0,0,1,1,
                                0,0,0,0,0,1,0,0,
                                0,0,0,0,0,1,0,1,
                                0,0,0,0,0,1,1,0,
                                0,0,0,0,0,1,1,1,
                                0,0,0,0,1,0,0,0,
                                0,0,0,0,1,0,0,1,
                                0,0,0,0,1,0,1,0,
                                0,0,0,0,1,0,1,1,
                                0,0,0,0,1,1,0,0,
                                0,0,0,0,1,1,0,1,
                                0,0,0,0,1,1,1,0,
                                0,0,0,0,1,1,1,1,
                                0,0,0,1,0,0,0,0,
                                0,0,0,1,0,0,0,1,
                                0,0,0,1,0,0,1,0,
                                0,0,0,1,0,0,1,1,
                                0,0,0,1,0,1,0,0,
                                0,0,0,1,0,1,0,1,
                                0,0,0,1,0,1,1,0,
                                0,0,0,1,0,1,1,1,
                                0,0,0,1,1,0,0,0,
                                0,0,0,1,1,0,0,1,
                                0,0,0,1,1,0,1,0,
                                0,0,0,1,1,0,1,1,
                                0,0,0,1,1,1,0,0,
                                0,0,0,1,1,1,0,1,
                                0,0,0,1,1,1,1,0,
                                0,0,0,1,1,1,1,1,
                                0,0,1,0,0,0,0,0,
                                0,0,1,0,0,0,0,1,
                                0,0,1,0,0,0,1,0,
                                0,0,1,0,0,0,1,1,
                                0,0,1,0,0,1,0,0,
                                0,0,1,0,0,1,0,1,
                                0,0,1,0,0,1,1,0,
                                0,0,1,0,0,1,1,1,
                                0,0,1,0,1,0,0,0,
                                0,0,1,0,1,0,0,1,
                                0,0,1,0,1,0,1,0,
                                0,0,1,0,1,0,1,1,
                                0,0,1,0,1,1,0,0,
                                0,0,1,0,1,1,0,1,
                                0,0,1,0,1,1,1,0,
                                0,0,1,0,1,1,1,1,
                                0,0,1,1,0,0,0,0,
                                0,0,1,1,0,0,0,1,
                                0,0,1,1,0,0,1,0,
                                0,0,1,1,0,0,1,1,
                                0,0,1,1,0,1,0,0,
                                0,0,1,1,0,1,0,1,
                                0,0,1,1,0,1,1,0,
                                0,0,1,1,0,1,1,1,
                                0,0,1,1,1,0,0,0,
                                0,0,1,1,1,0,0,1,
                                0,0,1,1,1,0,1,0,
                                0,0,1,1,1,0,1,1,
                                0,0,1,1,1,1,0,0,
                                0,0,1,1,1,1,0,1,
                                0,0,1,1,1,1,1,0,
                                0,0,1,1,1,1,1,1,
                                0,1,0,0,0,0,0,0,
                                0,1,0,0,0,0,0,1,
                                0,1,0,0,0,0,1,0,
                                0,1,0,0,0,0,1,1,
                                0,1,0,0,0,1,0,0,
                                0,1,0,0,0,1,0,1,
                                0,1,0,0,0,1,1,0,
                                0,1,0,0,0,1,1,1,
                                0,1,0,0,1,0,0,0,
                                0,1,0,0,1,0,0,1,
                                0,1,0,0,1,0,1,0,
                                0,1,0,0,1,0,1,1,
                                0,1,0,0,1,1,0,0,
                                0,1,0,0,1,1,0,1,
                                0,1,0,0,1,1,1,0,
                                0,1,0,0,1,1,1,1,
                                0,1,0,1,0,0,0,0,
                                0,1,0,1,0,0,0,1,
                                0,1,0,1,0,0,1,0,
                                0,1,0,1,0,0,1,1,
                                0,1,0,1,0,1,0,0,
                                0,1,0,1,0,1,0,1,
                                0,1,0,1,0,1,1,0,
                                0,1,0,1,0,1,1,1,
                                0,1,0,1,1,0,0,0,
                                0,1,0,1,1,0,0,1,
                                0,1,0,1,1,0,1,0,
                                0,1,0,1,1,0,1,1,
                                0,1,0,1,1,1,0,0,
                                0,1,0,1,1,1,0,1,
                                0,1,0,1,1,1,1,0,
                                0,1,0,1,1,1,1,1,
                                0,1,1,0,0,0,0,0,
                                0,1,1,0,0,0,0,1,
                                0,1,1,0,0,0,1,0,
                                0,1,1,0,0,0,1,1,
                                0,1,1,0,0,1,0,0,
                                0,1,1,0,0,1,0,1,
                                0,1,1,0,0,1,1,0,
                                0,1,1,0,0,1,1,1,
                                0,1,1,0,1,0,0,0,
                                0,1,1,0,1,0,0,1,
                                0,1,1,0,1,0,1,0,
                                0,1,1,0,1,0,1,1,
                                0,1,1,0,1,1,0,0,
                                0,1,1,0,1,1,0,1,
                                0,1,1,0,1,1,1,0,
                                0,1,1,0,1,1,1,1,
                                0,1,1,1,0,0,0,0,
                                0,1,1,1,0,0,0,1,
                                0,1,1,1,0,0,1,0,
                                0,1,1,1,0,0,1,1,
                                0,1,1,1,0,1,0,0,
                                0,1,1,1,0,1,0,1,
                                0,1,1,1,0,1,1,0,
                                0,1,1,1,0,1,1,1,
                                0,1,1,1,1,0,0,0,
                                0,1,1,1,1,0,0,1,
                                0,1,1,1,1,0,1,0,
                                0,1,1,1,1,0,1,1,
                                0,1,1,1,1,1,0,0,
                                0,1,1,1,1,1,0,1,
                                0,1,1,1,1,1,1,0,
                                0,1,1,1,1,1,1,1,
                                1,0,0,0,0,0,0,0,
                                1,0,0,0,0,0,0,1,
                                1,0,0,0,0,0,1,0,
                                1,0,0,0,0,0,1,1,
                                1,0,0,0,0,1,0,0,
                                1,0,0,0,0,1,0,1,
                                1,0,0,0,0,1,1,0,
                                1,0,0,0,0,1,1,1,
                                1,0,0,0,1,0,0,0,
                                1,0,0,0,1,0,0,1,
                                1,0,0,0,1,0,1,0,
                                1,0,0,0,1,0,1,1,
                                1,0,0,0,1,1,0,0,
                                1,0,0,0,1,1,0,1,
                                1,0,0,0,1,1,1,0,
                                1,0,0,0,1,1,1,1,
                                1,0,0,1,0,0,0,0,
                                1,0,0,1,0,0,0,1,
                                1,0,0,1,0,0,1,0,
                                1,0,0,1,0,0,1,1,
                                1,0,0,1,0,1,0,0,
                                1,0,0,1,0,1,0,1,
                                1,0,0,1,0,1,1,0,
                                1,0,0,1,0,1,1,1,
                                1,0,0,1,1,0,0,0,
                                1,0,0,1,1,0,0,1,
                                1,0,0,1,1,0,1,0,
                                1,0,0,1,1,0,1,1,
                                1,0,0,1,1,1,0,0,
                                1,0,0,1,1,1,0,1,
                                1,0,0,1,1,1,1,0,
                                1,0,0,1,1,1,1,1,
                                1,0,1,0,0,0,0,0,
                                1,0,1,0,0,0,0,1,
                                1,0,1,0,0,0,1,0,
                                1,0,1,0,0,0,1,1,
                                1,0,1,0,0,1,0,0,
                                1,0,1,0,0,1,0,1,
                                1,0,1,0,0,1,1,0,
                                1,0,1,0,0,1,1,1,
                                1,0,1,0,1,0,0,0,
                                1,0,1,0,1,0,0,1,
                                1,0,1,0,1,0,1,0,
                                1,0,1,0,1,0,1,1,
                                1,0,1,0,1,1,0,0,
                                1,0,1,0,1,1,0,1,
                                1,0,1,0,1,1,1,0,
                                1,0,1,0,1,1,1,1,
                                1,0,1,1,0,0,0,0,
                                1,0,1,1,0,0,0,1,
                                1,0,1,1,0,0,1,0,
                                1,0,1,1,0,0,1,1,
                                1,0,1,1,0,1,0,0,
                                1,0,1,1,0,1,0,1,
                                1,0,1,1,0,1,1,0,
                                1,0,1,1,0,1,1,1,
                                1,0,1,1,1,0,0,0,
                                1,0,1,1,1,0,0,1,
                                1,0,1,1,1,0,1,0,
                                1,0,1,1,1,0,1,1,
                                1,0,1,1,1,1,0,0,
                                1,0,1,1,1,1,0,1,
                                1,0,1,1,1,1,1,0,
                                1,0,1,1,1,1,1,1,
                                1,1,0,0,0,0,0,0,
                                1,1,0,0,0,0,0,1,
                                1,1,0,0,0,0,1,0,
                                1,1,0,0,0,0,1,1,
                                1,1,0,0,0,1,0,0,
                                1,1,0,0,0,1,0,1,
                                1,1,0,0,0,1,1,0,
                                1,1,0,0,0,1,1,1,
                                1,1,0,0,1,0,0,0,
                                1,1,0,0,1,0,0,1,
                                1,1,0,0,1,0,1,0,
                                1,1,0,0,1,0,1,1,
                                1,1,0,0,1,1,0,0,
                                1,1,0,0,1,1,0,1,
                                1,1,0,0,1,1,1,0,
                                1,1,0,0,1,1,1,1,
                                1,1,0,1,0,0,0,0,
                                1,1,0,1,0,0,0,1,
                                1,1,0,1,0,0,1,0,
                                1,1,0,1,0,0,1,1,
                                1,1,0,1,0,1,0,0,
                                1,1,0,1,0,1,0,1,
                                1,1,0,1,0,1,1,0,
                                1,1,0,1,0,1,1,1,
                                1,1,0,1,1,0,0,0,
                                1,1,0,1,1,0,0,1,
                                1,1,0,1,1,0,1,0,
                                1,1,0,1,1,0,1,1,
                                1,1,0,1,1,1,0,0,
                                1,1,0,1,1,1,0,1,
                                1,1,0,1,1,1,1,0,
                                1,1,0,1,1,1,1,1,
                                1,1,1,0,0,0,0,0,
                                1,1,1,0,0,0,0,1,
                                1,1,1,0,0,0,1,0,
                                1,1,1,0,0,0,1,1,
                                1,1,1,0,0,1,0,0,
                                1,1,1,0,0,1,0,1,
                                1,1,1,0,0,1,1,0,
                                1,1,1,0,0,1,1,1,
                                1,1,1,0,1,0,0,0,
                                1,1,1,0,1,0,0,1,
                                1,1,1,0,1,0,1,0,
                                1,1,1,0,1,0,1,1,
                                1,1,1,0,1,1,0,0,
                                1,1,1,0,1,1,0,1,
                                1,1,1,0,1,1,1,0,
                                1,1,1,0,1,1,1,1,
                                1,1,1,1,0,0,0,0,
                                1,1,1,1,0,0,0,1,
                                1,1,1,1,0,0,1,0,
                                1,1,1,1,0,0,1,1,
                                1,1,1,1,0,1,0,0,
                                1,1,1,1,0,1,0,1,
                                1,1,1,1,0,1,1,0,
                                1,1,1,1,0,1,1,1,
                                1,1,1,1,1,0,0,0,
                                1,1,1,1,1,0,0,1,
                                1,1,1,1,1,0,1,0,
                                1,1,1,1,1,0,1,1,
                                1,1,1,1,1,1,0,0,
                                1,1,1,1,1,1,0,1,
                                1,1,1,1,1,1,1,0,
                                1,1,1,1,1,1,1,1,
};

